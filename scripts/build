#!/bin/bash
DIR=`dirname $0`
pushd $DIR/..

if [ "$TEST_TOKEN" != "test-token" ]; then
  echo TEST_TOKEN is not test-token (FAIL)
  exit -1
fi
echo -e "TEST_TOKEN is test-token (ok)"
 
if [ "$NPM_AUTH_TOKEN" == "" ]; then
  echo -e "BUILD\t: NPM_AUTH_TOKEN is required (FAIL)"
  exit -1
fi

# DEBUG
VERSION=`$DIR/version`
echo VERSION $VERSION ok
exit 0

$DIR/js/build.js

git status | grep 'nothing to commit' > /dev/null; RC=$?
if [ "$RC" == "0" ]; then
    echo -e "BUILD\t: Nothing to commit"
else
    echo -e "BUILD\t: committing..."
    git commit -am "build"
    npm version patch
    VERSION=`$DIR/version`
    git reset --soft HEAD~1
    git commit --amend -m "v$VERSION build"
    git push
    npm publish
fi
